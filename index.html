<!DOCTYPE html>
<html>
<head>
    <title>C++ Lexical Analyzer</title>
    <style>
        body{font-family:Arial,sans-serif;margin:20px}
        textarea,select,button,input[type="file"]{margin:10px;padding:5px}
        #output{white-space:pre-wrap;margin:10px;border:1px solid white;padding:10px}
        label{margin-right:10px}
    </style>
</head>
<body>
    <h1>C++ Lexical Analyzer</h1>
    <label for="mode">Select Mode:</label>
    <select id="mode">
        <option value="general">General</option>
        <option value="compiler">Compiler</option>
    </select>
    <br>
    <label for="codeInput">Enter C++ Code:</label>
    <br>
    <textarea id="codeInput" rows="10" cols="100" placeholder="Enter C++ code here"></textarea>
    <br>
    <label for="fileInput">Or Upload .cpp File:</label>
    <input type="file" id="fileInput" accept=".cpp,.txt">
    <br>
    <button onclick="tokenize()">Tokenize</button>
    <button id="downloadBtn" onclick="downloadOutput()" disabled>Download Output as .txt</button>
    <div id="output"></div>
    <script src="lexer.js"></script>
    <script>
        let outputText='';
        createLexerModule().then(Module=>{
            const analyze=Module.cwrap('analyze','string',['string','string']);
            window.tokenize=function(){
                const mode=document.getElementById('mode').value;
                const fileInput=document.getElementById('fileInput');
                const codeInput=document.getElementById('codeInput').value;
                const outputDiv=document.getElementById('output');
                const downloadBtn=document.getElementById('downloadBtn');
                if(fileInput.files.length>0){
                    const file=fileInput.files[0];
                    const reader=new FileReader();
                    reader.onload=function(e){
                        const code=e.target.result;
                        outputText=analyze(code,mode);
                        outputDiv.textContent=outputText;
                        downloadBtn.disabled=false;
                    };
                    reader.onerror=function(){
                        outputDiv.textContent='Error reading file.';
                        downloadBtn.disabled=true;
                    };
                    reader.readAsText(file);
                }else if(codeInput.trim()!==''){
                    outputText=analyze(codeInput,mode);
                    outputDiv.textContent=outputText;
                    downloadBtn.disabled=false;
                }else{
                    outputDiv.textContent='Please enter code or upload a .cpp file.';
                    downloadBtn.disabled=true;
                }
            };
            window.downloadOutput=function(){
                if(outputText){
                    const blob=new Blob([outputText],{type:'text/plain'});
                    const url=URL.createObjectURL(blob);
                    const a=document.createElement('a');
                    a.href=url;
                    a.download='tokenized_output.txt';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            };
        }).catch(err=>{
            console.error('Failed to load WebAssembly module:',err);
            document.getElementById('output').textContent='Error: Failed to load WebAssembly module.';
        });
    </script>
</body>
</html>